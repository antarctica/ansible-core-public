---
# Setup infrastructure for testing role

# Apply role to test VMs,
# host-vars are used to control which features of the role are applied to each VM.
# For each test a set of tasks will be run to check the selected features of roles are correctly applied.

- name: setup and test the core vm setup role
  hosts: barc-core-test-nodes
  remote_user: controller
  sudo: yes
  roles:
    - ../../../core-public
  tasks:
    - meta: flush_handlers
    - apt: update_cache=yes cache_valid_time=3600 pkg=git state=present # won't update if done under an hour ago
    - git: repo="ssh://git@stash.ceh.ac.uk:7999/barc/apache.git" version=master dest="~/rencia"
